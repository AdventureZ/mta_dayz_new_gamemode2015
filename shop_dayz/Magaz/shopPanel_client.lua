local itemsMagaz = 
{
["Транспорт"] = {
{"Наполненная канистра",800,1,300,1},
{"Колесо",900,1,260,1},
{"Двигатель",1500,1,600,1},
{"Бензобак",1000,1,500,1},
},

["Одежда"] = {
{"Армейский камуфляж",1000,1,350,1},
{"Агент призрак",1000,1,350,1},
{"Одежда инженера",1000,1,350,1},
{"Пустынный камуфляж",1500,1,500,1},
{"Одежда разведчика",1000,1,350,1},
{"Гражданская одежда",300,1,150,1},
{"Полицейская форма",800,1,200,1},
{"Женская одежда",800,1,200,1},
{"Женский камуфляж",1500,1,500,1},
{"Одежда мародера",500,1,200,1},
{"Одежда наёмника",1000,1,350,1},
{"Женский скин",100,1,50,1},
{"Тяжелая броня",1000,1,250,1},
{"Одежда выжившего",100,1,50,1},
{"Камуфляж снайпера",1500,1,500,1},
},

["Необходимость"] = {
{"Спички",200,1,50,1},
{"Инфокрасные очки",500,1,200,1},
{"Очки ночного видения",500,1,200,1},
{"GPS",800,1,50,1},
{"Карта",1000,1,50,1},
{"Инструменты",650,1,50,1},
{"Часы",500,1,50,1},
{"Рация",300,1,50,1},
},

["Оружие"] = {
{"ПКП",10000,1,2500,1},
{"AS50",20000,1,7500,1},
{"ACR",12500,1,3500,1},
{"G36C SD",9500,1,1500,1},
{"MP5",5000,1,500,1},
{"M4A1 CCO",12000,1,5000,1},
{"M16A2 + M203",20000,1,5000,1},
{"M200",22000,1,5000,1},
{"M4A1 Holo",20000,1,5000,1},
{"SA-58V ACOG",12500,1,5000,1},
{"SVD Camo",19000,1,7000,1},
{"CZ550",16500,1,5500,1},
{"DMR",19000,1,7000,1},
{"KSVK",25000,1,7500,1},
{"M249 SAW",15000,1,4000,1},
{"M107",19000,1,7000,1},
{"M40A3",14000,1,4000,1},
{"Арбалет",12000,1,3500,1},
{"MK48",10000,1,3500,1},
{"M240",14000,1,4500,1},
{"M14",10000,1,2250,1},
{"JNG-90",16000,1,5500,1},
{"AKS-74U",10000,1,3500,1},
{"G36K",9500,1,1500,1},
{"Benelli M3",8000,1,2000,1},
{"SPAZ-12",6000,1,2000,1},
{"Sawn-Off Shotgun",5000,1,2000,1},
{"AKM GP",20000,1,3750,1},
{"AKM",12000,1,3750,1},
{"AKS",11000,1,2250,1},
{"Lee Enfield",10000,1,2250,1},
{"FN SCAR",11000,1,3750,1},
{"M9 SD",2500,1,1750,1},
{"PDW",8000,1,2000,1},
{"Desert Deagle",5000,1,1500,1},
{"Лопата",1000,1,250,1},
{"Граната",5000,1,250,1},
},

["Патроны"] = {
{"M9 SD Mag",500,15,250,15},
{"AS50 Mag",2000,5,500,5},
{"ACR Mag",1500,30,300,30},
{"G36K Mag",1300,30,250,30},
{"MP5 Mag",1000,30,150,30},
{"STANAG",1400,30,250,30},
{"M200 Mag",1000,30,250,30},
{"SA-58 Mag",1500,30,300,30},
{"SVD Camo Mag",1900,5,450,5},
{"CZ550 Mag",1400,5,300,5},
{"DMR Mag",2000,5,500,5},
{"KSVK Mag",3000,5,1000,5},
{"M24 Mag",2000,5,500,5},
{"M249 SAW Mag",1700,100,350,100},
{"M107 Mag",1900,5,450,5},
{"M40A3 Mag",2000,5,500,5},
{"Arrow",1300,10,200,10},
{"Desert Deagle Mag",1000,7,100,7},
{"PDW Mag",1200,30,150,30},
{"AKM Mag",1350,30,250,30},
{"M14 Mag",1250,10,200,10},
{"JNG-90 Mag",1900,10,450,10},
{"M240 Mag",1400,100,250,100},
{"ПКП Mag",1550,100,300,100},
{"MK48 Mag",1550,100,350,100},
{"G36K Mag",1300,20,200,20},
{"Benelli M3 Mag",1000,7,100,7},
{"2Rnd. Slug",1000,2,100,2},
{"SPAZ-12 Slug",1000,7,100,7},
{"Lee Enfield Mag",1500,10,300,10},
},
["Рюкзаки "] = {
{"Assault Pack (ACU)",1000,1,250,1},
{"Alice Pack",1500,1,500,1},
{"Czech Backpack",3500,1,650,1},
{"Survival Backpack",5500,1,1000,1},
{"Dead Backpack",7500,1,2500,1},
{"Ghillie Backpack",3500,1,850,1},
{"Mega Backpack",20000,1,5000,1},
{"Nova Backpack",6500,1,2750,1},
{"Coyote Backpack",4500,1,900,1},
},
["Медикоменты"] = {
{"Бинт",500,1,250,1},
{"Морфий",500,1,250,1},
{"Аптечка",1000,1,500,1},
{"Грелка",500,1,250,1},
{"Пакет крови",500,1,250,1},
{"Болеутоляющие",500,1,250,1},
},
["Еда/Вода"] = {
{"Фляга",200,1,100,1},
{"Банка макарон",200,1,100,1},
{"Банка бобов",200,1,100,1},
{"Гамбургер",200,1,100,1},
{"Пицца",200,1,100,1},
{"Банка соды",300,1,150,1},
{"Молоко",500,1,250,1},
{"Сырое мясо",200,1,100,1},
{"Жареное мясо",300,1,150,1},
	},
}

local tabPanel = {}
local buttons = {}
local labels = {}

local maksam07 = 
{ 	
	gridList = {},
	label = {},
	editBox = {},
	button = {},
	comboBox = {},
	CheckBox = {}
}

screenWidth,screenHeight = guiGetScreenSize()
mainWidth,mainHeight = 700,400


function shopInterface()

	shop_window = guiCreateWindow(screenWidth/1-mainWidth/1,screenHeight/1-mainHeight/1,mainWidth,mainHeight,"Магазин",false)
	guiSetVisible(shop_window, false)
    guiSetAlpha(shop_window, 0.95)
	guiWindowSetSizable(shop_window, false)

	
	maksam07.gridList.KatName = guiCreateGridList ( 10, 30, 170, 200, false, shop_window) --96
	guiGridListSetSortingEnabled ( maksam07.gridList.KatName, false )
	guiGridListAddColumn ( maksam07.gridList.KatName, "Категория", 0.9 )
	
	
	maksam07.gridList.Weapons = guiCreateGridList ( 180, 30, 520, 330, false, shop_window) --96
	guiGridListSetSortingEnabled ( maksam07.gridList.Weapons, false )
	guiGridListAddColumn ( maksam07.gridList.Weapons, "Предмет", 0.4 )
	guiGridListAddColumn ( maksam07.gridList.Weapons, "Цена купли", 0.16 )
	guiGridListAddColumn ( maksam07.gridList.Weapons, "Кол-во", 0.11 )
	guiGridListAddColumn ( maksam07.gridList.Weapons, "Цена продажи", 0.16 )
	guiGridListAddColumn ( maksam07.gridList.Weapons, "Кол-во", 0.11 )
	
	maksam07.label.my = guiCreateLabel(15,270,160,35,"Денег у Вас:\n" .. (getElementData(localPlayer, "Деньги") or 0),false,shop_window)
	maksam07.label.colPred = guiCreateLabel(15,300,160,35,"",false,shop_window)
	
	maksam07.label.slots = guiCreateLabel(15,330,160,35,"",false,shop_window)
	maksam07.label.slots_treb = guiCreateLabel(15,345,160,35,"",false,shop_window)
	
	
	buttons.buy = guiCreateButton(300, 370, 100, 24, "Купить", false, shop_window)
	guiSetFont(buttons.buy , "default-bold-small")
	
	buttons.sale = guiCreateButton(410, 370, 100, 24, "Продать", false, shop_window)
	guiSetFont(buttons.sale , "default-bold-small")
	
	
	buttons.Sair = guiCreateButton(570, 370, 100, 24, "Закрыть", false, shop_window)
	guiSetFont(buttons.Sair , "default-bold-small")

	
	for _, button in pairs(buttons) do 
		guiSetProperty(button, "HoverTextColour", "FFFFFF00") 
	end
	
	addEventHandler("onClientGUIClick", maksam07.gridList.KatName, function ( )
		local text = guiGridListGetItemText ( maksam07.gridList.KatName, guiGridListGetSelectedItem ( maksam07.gridList.KatName ), 1 )
		guiGridListClear(maksam07.gridList.Weapons)
		if text == "" then return false end
		for i, value in ipairs(itemsMagaz[text]) do
		local row = guiGridListAddRow ( maksam07.gridList.Weapons )
			guiGridListSetItemText ( maksam07.gridList.Weapons, row, 1, value[1], false, false )
			guiGridListSetItemText ( maksam07.gridList.Weapons, row, 2, value[2], false, false )
			guiGridListSetItemText ( maksam07.gridList.Weapons, row, 3, value[3], false, false )
			guiGridListSetItemText ( maksam07.gridList.Weapons, row, 4, value[4], false, false )
			guiGridListSetItemText ( maksam07.gridList.Weapons, row, 5, value[5], false, false )
		end
	end, false )
	
	
	addEventHandler( "onClientGUIClick", buttons.buy,
	function ( )
		local weapon = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 1)
		local buy = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 2)
		local current = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 3)
		if (not weapon or weapon == "") then return end
			if getPlayerCurrentSlots() + getItemSlots(weapon) <= getPlayerMaxAviableSlots() then
				if getElementData ( localPlayer, "Деньги") >= tonumber(buy) then
					setElementData(localPlayer,weapon,getElementData(localPlayer,weapon)+current)
					setElementData ( localPlayer, "Деньги", getElementData ( localPlayer, "Деньги" )-buy )
					setElementData(root, "moneyRPMagin", getElementData(root, "moneyRPMagin")+ buy)
					yesmoney(weapon, buy, current)
				else
					notmoney(weapon, buy, current)
				end
			else
				outputChatBox("#FF0000[SHOP] #FF0000Не хватает места в инвентаре!", 255, 255, 255 , true)
			end
			
			guiSetText ( maksam07.label.my, "Денег у Вас:\n" .. (getElementData(localPlayer, "Деньги") or 0) )
	end, false)
	
	
	addEventHandler( "onClientGUIClick", buttons.sale,
	function ( )
		local weapon = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 1)
		local buy = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 4)
		local current = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 5)
		if (not weapon or weapon == "") then return end
			if getElementData ( root, "moneyRPMagin") >= tonumber(buy) then
				if getElementData ( localPlayer, weapon) >= tonumber(current) then
					setElementData(localPlayer,weapon,getElementData(localPlayer,weapon)-current)
					setElementData ( root, "moneyRPMagin", getElementData ( root, "moneyRPMagin" )+buy )
					setElementData(localPlayer, "Деньги", getElementData(localPlayer, "Деньги")+buy)
					yesmoney1(weapon, buy, current)
				else
					notmoney2(weapon, buy, current)
				end
			else
				notmoney1(weapon, buy, current)
			end
			
			guiSetText ( maksam07.label.my, "Денег у Вас:\n" .. (getElementData(localPlayer, "Деньги") or 0) )
	end, false)

	
	
	addEventHandler( "onClientGUIClick", buttons.Sair,
	function ( )
		guiSetVisible(shop_window,false)
		showCursor(false)
		
		if isTimer(timerMoney) then
			killTimer ( timerMoney )
		end
		
	end, false)
end
addEventHandler("onClientResourceStart", getResourceRootElement(getThisResource()), shopInterface)


function notmoney(weapon, buy, current)
	outputChatBox("#FF0000[SHOP] #FF0000Не хватает денег для покупки #FFFF00"..weapon, 255, 255, 255 , true)
end

function notmoney1(weapon, buy, current)
	outputChatBox("#FF0000[SHOP] #FF0000У торговца не хватает денег!", 255, 255, 255 , true)
end

function notmoney2(weapon, buy, current)
	outputChatBox("#FF0000[SHOP] #FF0000У Вас нет столько предметов!", 255, 255, 255 , true)
end


function yesmoney(weapon, buy, current)
	outputChatBox("#FF0000[SHOP] #00FF00Успешно куплено!", 255, 255, 255 , true)
end
 
function yesmoney1(weapon, buy, current)
	outputChatBox("#FF0000[SHOP] #00FF00Успешно продали!", 255, 255, 255 , true)
end

function refreshMoney()
	guiSetText ( maksam07.label.my, "Денег у Вас:\n" .. (getElementData(localPlayer, "Деньги") or 0) )
	
	local weapon = guiGridListGetItemText(maksam07.gridList.Weapons, guiGridListGetSelectedItem(maksam07.gridList.Weapons), 1)
	if (not weapon or weapon == "") then
		guiSetText ( maksam07.label.slots, "")
		guiSetText ( maksam07.label.slots_treb, "")
		guiSetText ( maksam07.label.colPred, "")
		return 
	end
	guiSetText ( maksam07.label.colPred, weapon..": \n" .. (getElementData(localPlayer, weapon) or 0) )
	
	
	guiSetText ( maksam07.label.slots, "Слоты: "..getPlayerCurrentSlots().."/"..getPlayerMaxAviableSlots())
	guiSetText ( maksam07.label.slots_treb, "Занимает: "..getItemSlots(weapon).."")
end


function AbrirJanela2()
	guiSetVisible(shop_window,true)
	showCursor(true)
	
	guiGridListClear(maksam07.gridList.Weapons)
	guiGridListClear(maksam07.gridList.KatName)
	timerMoney = setTimer ( refreshMoney, 50, 0 )
	
	guiSetText ( maksam07.label.my, "Денег у Вас:\n" .. (getElementData(localPlayer, "Деньги") or 0) )
	guiSetText ( maksam07.label.slots, "")
	guiSetText ( maksam07.label.slots_treb, "")
	
	for key, value in pairs (itemsMagaz) do
		if type(value) == "table" then
			local row = guiGridListAddRow ( maksam07.gridList.KatName )
			guiGridListSetItemText ( maksam07.gridList.KatName, row, 1, key, false, false )
		end
	end
end
addEvent("openWindow",true)
addEventHandler("openWindow", getRootElement(), AbrirJanela2)